# ERD 설계 시 Index 설정에 대하여

날짜: 2024년 3월 5일
작성자: DJ lata

### 문제상황

- ERD 설계 중 검색 조건에 사용되는 필드에 모두 index를 적용했었다.
    - 검색 성능에는 분명 좋으나 여러개의 인덱스가 적용될 때 제대로 적용될지 의문이었고 동시에 인덱스 사용시 생기는 부작용 (생성, 수정, 삭제시 성능 저하, 용량 문제) 에 대해 고민
- 유저당 Download 중복을 검사하기 위해 Download 테이블을 Member, Bouquet, Flower PK를 외래키로 가지는 테이블을 만들었는데 이 설계가 맞는지 의문이었다

### 질문사항

1. 검색에 사용되는 경우 모두 Index를 적용해야 하는가? 그렇다면 어디까지 인덱스를 적용해도 되는가?
2. 현업에서 인덱스를 어떻게/어떤경우에 사용하는가?
3. Download 테이블을 따로 빼는 것이 맞는가?

### 해결

- **Index 사용 X**
    - 기본적으로 클러스터링 인덱스만으로 해결하되 성능 테스트와 검증을 거쳐 인덱스를 추가할 것을 고려해야하며, 이는 신중하게 해야함
    - 1000만개 이하의 테이블에서는 인덱스로 인한 성능 향상이 크게 의미가 없음
        - 오히려 인덱스를 타고 들어가는데 더 오래 걸릴 수 있음

- **언제 Index 사용해야하는가?**
    - Unique 할 때 : Non-Unique 할 때 성능이 좋지 않다
    - CUD보다 R의 비중이 월등히 높을 때

- **데이터 정합성 문제**
    - Flower , Bouquet 에 대한 중간테이블이 있는데 Flower , Bouquet, Member에 대한 중간테이블이 생기면 데이터 정합성 문제가 있다!
    - 정말 필요한 것이 아니면 비정규화 및 데이터 중복은 피해야 한다
    - 단순한 비효율이 아닌, RDBMS의 근간이 흔들릴 수 있기 때문

### 컨설턴트님 솔루션

- 전통적인 RDBMS 관점에서는 JPA를 사용하는 방식보다 재사용성 및 데이터 정합성을 고려해야한다